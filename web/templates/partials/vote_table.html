{{define "vote_table"}}
<table class="w-full text-sm">
    <thead>
        {{if .headerGroups}}
        <tr class="border-b border-background-100 bg-background-50">
            <th rowspan="2" class="px-4 py-3 text-left font-medium text-text-600">{{ call $.t "poll.table_name" }}</th>
            {{range .headerGroups}}
            <th colspan="{{.Colspan}}" class="px-4 py-2 text-center text-xs font-semibold text-text-500{{if .Label}} border-l border-background-200{{end}}">{{.Label}}</th>
            {{end}}
            {{if $.isAdmin}}
            <th rowspan="2" class="px-4 py-3 text-center font-medium text-text-600"></th>
            {{end}}
        </tr>
        <tr class="border-b border-background-200 bg-background-50">
            {{range .headerGroups}}{{range .Columns}}
            <th class="px-4 py-2 text-center text-sm font-medium text-text-600">{{.Label}}</th>
            {{end}}{{end}}
        </tr>
        {{else}}
        <tr class="border-b border-background-200 bg-background-50">
            <th class="px-4 py-3 text-left font-medium text-text-600">{{ call $.t "poll.table_name" }}</th>
            {{range .poll.Options}}
            <th class="px-4 py-3 text-center font-medium text-text-600">{{ . }}</th>
            {{end}}
            {{if .isAdmin}}
            <th class="px-4 py-3 text-center font-medium text-text-600"></th>
            {{end}}
        </tr>
        {{end}}
    </thead>
    <tbody>
        {{if .poll.Votes}}
        {{range $idx, $vote := .poll.Votes}}
        <!-- Display row -->
        <tr {{if $.isAdmin}}id="display-{{$idx}}"{{end}} class="border-b border-background-100">
            <td class="max-w-40 wrap-break-word px-4 py-3 font-medium text-text-800">{{ $vote.Name }}</td>
            {{$responses := $vote.Responses}}
            {{range $.poll.Options}}
            <td class="px-4 py-3 text-center">
                {{if eq (index $responses .) "yes"}}
                <span class="inline-flex size-6 items-center justify-center rounded-full bg-green-100 text-green-600">
                    <span class="size-4 bg-current" style="-webkit-mask-image:url(/static/icons/vote-yes.svg);mask-image:url(/static/icons/vote-yes.svg);-webkit-mask-size:contain;mask-size:contain" aria-hidden="true"></span>
                </span>
                {{else if eq (index $responses .) "maybe"}}
                <span class="inline-flex size-6 items-center justify-center rounded-full bg-amber-100 text-amber-600">
                    <span class="size-4 bg-current" style="-webkit-mask-image:url(/static/icons/vote-maybe.svg);mask-image:url(/static/icons/vote-maybe.svg);-webkit-mask-size:contain;mask-size:contain" aria-hidden="true"></span>
                </span>
                {{else}}
                <span class="inline-flex size-6 items-center justify-center rounded-full bg-red-100 text-red-500">
                    <span class="size-4 bg-current" style="-webkit-mask-image:url(/static/icons/vote-no.svg);mask-image:url(/static/icons/vote-no.svg);-webkit-mask-size:contain;mask-size:contain" aria-hidden="true"></span>
                </span>
                {{end}}
            </td>
            {{end}}
            {{if $.isAdmin}}
            <td class="px-4 py-3 text-center">
                <div class="inline-flex gap-1">
                    <button type="button" onclick="startEdit({{$idx}})"
                            class="flex items-center justify-center rounded-lg border border-background-300 p-1.5 text-text-400 transition hover:border-primary-300 hover:text-primary-500"
                            title="{{ call $.t "admin.edit_title" $vote.Name }}">
                        <span class="size-4 bg-current" style="-webkit-mask-image:url(/static/icons/pencil.svg);mask-image:url(/static/icons/pencil.svg);-webkit-mask-size:contain;mask-size:contain" aria-hidden="true"></span>
                    </button>
                    <button type="button" data-action="remove" data-voter="{{ $vote.Name }}"
                            class="flex items-center justify-center rounded-lg border border-background-300 p-1.5 text-text-400 transition hover:border-accent-300 hover:text-accent-500"
                            title="{{ call $.t "admin.remove_title" $vote.Name }}">
                        <span class="size-4 bg-current" style="-webkit-mask-image:url(/static/icons/x-mark.svg);mask-image:url(/static/icons/x-mark.svg);-webkit-mask-size:contain;mask-size:contain" aria-hidden="true"></span>
                    </button>
                </div>
            </td>
            {{end}}
        </tr>
        {{if $.isAdmin}}
        <!-- Edit row (hidden by default) -->
        <tr id="edit-{{$idx}}" class="hidden border-b border-background-100 bg-primary-50/50 dark:bg-primary-950/20">
            <td class="px-4 py-3">
                <input type="text" name="name" value="{{ $vote.Name }}"
                       autocomplete="off" data-1p-ignore data-lpignore="true" data-form-type="other"
                       class="w-full min-w-32 rounded-md border border-background-300 bg-white px-2.5 py-1.5 text-sm text-text-800 placeholder-text-400 focus:border-primary-400 focus:ring-2 focus:ring-primary-100 dark:bg-background-100">
                <input type="hidden" name="old_name" value="{{ $vote.Name }}">
            </td>
            {{range $.poll.Options}}
            <td class="px-4 py-3 text-center">
                <input type="hidden" name="vote-{{ . }}" value="{{index $responses .}}">
                <div class="inline-flex flex-col overflow-hidden rounded-full border border-background-300">
                    <!-- Yes -->
                    <button type="button" class="vote-btn flex size-8 items-center justify-center border-b border-background-300 transition hover:bg-green-50 hover:text-green-400 {{if eq (index $responses .) "yes"}}bg-green-100 text-green-600{{else}}bg-background-50 text-background-300{{end}}"
                            data-value="yes" aria-pressed="{{if eq (index $responses .) "yes"}}true{{else}}false{{end}}">
                        <span class="size-3.5 bg-current" style="-webkit-mask-image:url(/static/icons/vote-yes.svg);mask-image:url(/static/icons/vote-yes.svg);-webkit-mask-size:contain;mask-size:contain" aria-hidden="true"></span>
                    </button>
                    {{if eq $.answerMode "ymn"}}
                    <!-- Maybe -->
                    <button type="button" class="vote-btn flex size-8 items-center justify-center border-b border-background-300 transition hover:bg-amber-50 hover:text-amber-400 {{if eq (index $responses .) "maybe"}}bg-amber-100 text-amber-600{{else}}bg-background-50 text-background-300{{end}}"
                            data-value="maybe" aria-pressed="{{if eq (index $responses .) "maybe"}}true{{else}}false{{end}}">
                        <span class="size-3.5 bg-current" style="-webkit-mask-image:url(/static/icons/vote-maybe.svg);mask-image:url(/static/icons/vote-maybe.svg);-webkit-mask-size:contain;mask-size:contain" aria-hidden="true"></span>
                    </button>
                    {{end}}
                    <!-- No -->
                    <button type="button" class="vote-btn flex size-8 items-center justify-center transition hover:bg-red-50 hover:text-red-400 {{if eq (index $responses .) "no"}}bg-red-100 text-red-500{{else}}bg-background-50 text-background-300{{end}}"
                            data-value="no" aria-pressed="{{if eq (index $responses .) "no"}}true{{else}}false{{end}}">
                        <span class="size-3.5 bg-current" style="-webkit-mask-image:url(/static/icons/vote-no.svg);mask-image:url(/static/icons/vote-no.svg);-webkit-mask-size:contain;mask-size:contain" aria-hidden="true"></span>
                    </button>
                </div>
            </td>
            {{end}}
            <td class="px-4 py-3 text-center">
                <div class="inline-flex gap-1">
                    <button type="button" data-action="edit-save" data-idx="{{$idx}}"
                            class="flex items-center justify-center rounded-lg border border-background-300 p-1.5 text-text-400 transition hover:border-green-400 hover:text-green-500"
                            title="{{ call $.t "admin.save" }}">
                        <span class="size-4 bg-current" style="-webkit-mask-image:url(/static/icons/check.svg);mask-image:url(/static/icons/check.svg);-webkit-mask-size:contain;mask-size:contain" aria-hidden="true"></span>
                    </button>
                    <button type="button" onclick="cancelEdit({{$idx}})"
                            class="flex items-center justify-center rounded-lg border border-background-300 p-1.5 text-text-400 transition hover:border-accent-300 hover:text-accent-500"
                            title="{{ call $.t "admin.cancel" }}">
                        <span class="size-4 bg-current" style="-webkit-mask-image:url(/static/icons/x-mark.svg);mask-image:url(/static/icons/x-mark.svg);-webkit-mask-size:contain;mask-size:contain" aria-hidden="true"></span>
                    </button>
                </div>
            </td>
        </tr>
        {{end}}
        {{end}}
        {{else}}
        {{if .isAdmin}}
        <tr>
            <td colspan="99" class="px-4 py-8 text-center text-sm text-text-400">
                {{ call $.t "admin.empty" }}
            </td>
        </tr>
        {{end}}
        {{end}}
        <!-- Inline vote input row -->
        <tr class="border-b border-background-100 bg-primary-50/50">
            <td class="px-4 py-3">
                <label for="vote-name" class="sr-only">{{ call $.t "poll.sr_your_name" }}</label>
                <input type="text" id="vote-name" name="name" placeholder="{{ call $.t "poll.placeholder_name" }}"
                       autocomplete="off" data-1p-ignore data-lpignore="true" data-form-type="other"
                       class="w-full min-w-32 rounded-md border border-background-300 bg-white px-2.5 py-1.5 text-base sm:text-sm text-text-800 placeholder-text-400 focus:border-primary-400 focus:ring-2 focus:ring-primary-100 dark:bg-background-100">
            </td>
            {{range .poll.Options}}
            <td class="px-4 py-3 text-center">
                <input type="hidden" name="vote-{{ . }}" value="">
                <div class="inline-flex flex-col overflow-hidden rounded-full border border-background-300">
                    <!-- Yes -->
                    <button type="button" class="vote-btn flex size-8 items-center justify-center border-b border-background-300 bg-background-50 text-background-300 transition hover:bg-green-50 hover:text-green-400"
                            data-value="yes" aria-label="{{ call $.t "poll.aria_available" . }}" aria-pressed="false">
                        <span class="size-3.5 bg-current" style="-webkit-mask-image:url(/static/icons/vote-yes.svg);mask-image:url(/static/icons/vote-yes.svg);-webkit-mask-size:contain;mask-size:contain" aria-hidden="true"></span>
                    </button>
                    {{if eq $.answerMode "ymn"}}
                    <!-- Maybe -->
                    <button type="button" class="vote-btn flex size-8 items-center justify-center border-b border-background-300 bg-background-50 text-background-300 transition hover:bg-amber-50 hover:text-amber-400"
                            data-value="maybe" aria-label="{{ call $.t "poll.aria_maybe" . }}" aria-pressed="false">
                        <span class="size-3.5 bg-current" style="-webkit-mask-image:url(/static/icons/vote-maybe.svg);mask-image:url(/static/icons/vote-maybe.svg);-webkit-mask-size:contain;mask-size:contain" aria-hidden="true"></span>
                    </button>
                    {{end}}
                    <!-- No -->
                    <button type="button" class="vote-btn flex size-8 items-center justify-center bg-background-50 text-background-300 transition hover:bg-red-50 hover:text-red-400"
                            data-value="no" aria-label="{{ call $.t "poll.aria_not_available" . }}" aria-pressed="false">
                        <span class="size-3.5 bg-current" style="-webkit-mask-image:url(/static/icons/vote-no.svg);mask-image:url(/static/icons/vote-no.svg);-webkit-mask-size:contain;mask-size:contain" aria-hidden="true"></span>
                    </button>
                </div>
            </td>
            {{end}}
            {{if .isAdmin}}
            <td></td>
            {{end}}
        </tr>
    </tbody>
    {{if .poll.Votes}}
    <tfoot>
        <tr class="bg-background-50">
            <td class="px-4 py-3 text-sm font-semibold text-text-700">{{ call $.t "poll.table_total" }}</td>
            {{range .poll.Options}}
            <td class="px-4 py-3 text-center text-sm font-semibold {{if and $.winners (index $.winners .)}}text-amber-600{{else}}text-primary-600{{end}}">
                <span class="relative inline-block">
                    {{if and $.winners (index $.winners .)}}
                    <span class="absolute -left-4 top-1/2 size-3 -translate-y-1/2 bg-amber-400" style="-webkit-mask-image:url(/static/icons/star.svg);mask-image:url(/static/icons/star.svg);-webkit-mask-size:contain;mask-size:contain" aria-hidden="true"></span>
                    {{end}}
                    {{(index $.totals .).Yes}}{{if gt (index $.totals .).Maybe 0}} + {{(index $.totals .).Maybe}}{{end}}
                </span>
            </td>
            {{end}}
            {{if $.isAdmin}}
            <td></td>
            {{end}}
        </tr>
    </tfoot>
    {{end}}
</table>
{{end}}
